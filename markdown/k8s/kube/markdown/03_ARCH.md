# 쿠버네티스 아키텍처 


- 마스터 
    - 고가용성을 위해 3대의 마스터 서버 구성 (1개의 리더 마스터, 나머지 2개는 대기)
    - etcd : coreOS에서 개발한 고가용성을 제공하는 키값 저장소, 서버 하나당 한개의 프로세스를 가짐 
    - kube-apiserver :  쿠버네티스 클러스터의 API를 사용할 수 있도록 하는 컴포넌트 
        - 클러스터로 온 요청이 유효한지 검증 
        - 쿠버네티스에 보내는 모든 요청은 kube-apiserver를 이용해서 다른 컴포넌트로 전달
        - 수평적으로 확장할 수 있도록 설계했음으로 서버 여러 대에 여러 개 kuber-apiserver를 사용 가능
    - kube-scheduler
        - 현재 클러스터 안에서 자원 할당이 가능한 노드 중 알맞은 노드를 선택해 새롭게 만든 파드를 실행.
        - 파드 생성시 kube-scheduler rk whrjsdp akwsms shemfmf ckwdma.
    - kube-controller-manager 
        - 파드를 관리하는 컨트롤러는 바이너리 파일하나로 컴파일해 단일 프로세스로 실행, 컨트롤러 각각을 실행하는 컴포넌트
    - cloud-controller-manager 
        - 클라우드 서비스와 연결해 관리하는 컴포넌트
        - 노드 컨트롤러 : 클라우드 서비스 안에서 노드를 관리하는 데 사용
        - 라우트 컨트롤러 : 각 클라우드 서비스 안의 네트워크 라우팅을 관리하는데 사용
        - 서비스 컨트롤러 : 각 클라우드 서비스에서 제공하는 로드밸런서를 생성, 갱신, 삭제 하는데 사용
        - 볼륨 컨트롤러 : 클라우드 서비스에서 생성한 볼륨을 노드에 연결해 마운트하는데 사용
- 노드용
    - kubelet
        - 클러스터 안 모든 노드에서 실행되는 에이전트.
        - 파드 컨테이너들의 실행을 집적 관리함
        - 파드스펙이라는 조건이 담긴 설정을 전달받아서 컨테이너를 실행하고 컨테이너가 정상적으로 실행되는지 헬스체크를 진행함
    - kube-proxy : 클러스터 안에 별도의 가상 네트워크르 설정하고 관리함

- 애드온 : 클러스터안에서 필요한 기능을 실행하는 파드. 네임스페이스는 kube-system
    - 네트워킹 애드온 : 애저, AWS, GCP 등 별도의 네트워킹 애드온을 제공
    - DNS 애드온 : 클러스터 안에서 동작하는 DNS 서버 , 주로 CoreDNS를 사용함
    - 대시보드 애드온 : 웹 UI로 쿠버네티스를 사용할 수 있게함
    - 컨테이너 자원 모니터링 : 클러스터안에서 실행 중인 컨터이너의 상태를 모니터링하는 애드온. kubelet안에 포함된 cAdvisor라는 컨테이너 모니터링 도구 사용 
    - 클러스터 로깅 : 클러스터 안 개별 컨테이너의 로그와 쿠버네티스 구성 요소의 로그들을 중앙화한 로그 수집 애드온  

<br>

## 오브젝트와 컨트롤러 

> 쿠버네티스는 크게 오브젝트와 오브젝트를 관리하는 컨트롤러로 나뉨. 
> 사용자는 템플릿 등으로 쿠버네티스에 자원의 바라는 상태를 정의하고 컨트롤러는 바라는 상태와 현재 상태가 일치하도록 오브젝트들을 생성/삭제함 

- 오브젝트 : 파드, 서비스, 볼륨,네임스페이스 
    - 네임스페이스 : 쿠버네티스 클러스터 하나를 여러 개 논리적인 단위로 나눠사용하는 것 
    - 네임스페이스 
```bash
# 네임스페이스 확인
kubectl config current-context

# 켄텍스트의 정보를 확인
kubectl config get-contexts docker-desktop

# 네임스테이스 이름 변경 
kubectl config set-context docker-desktop --namespace=kube-system 

# 네임스페이스 확인
kubectl config view | grep namespace

# 파드가 어떤 네임스페이스로 설정되었는지 확인 
kubectl get pod --all-namespaces
```

- 컨트롤러 : 레프리카세트,디플로이먼트, 스테이트풀세트, 데몬세트, 잡



    
